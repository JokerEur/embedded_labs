## Лабораторная работа 3: Аналоговые входы и выходы

**Цель**

* Изучить аналоговые входы и выходы ESP32.
* Подключить потенциометр к аналоговому входу и светодиод к аналоговому выходу.
* Изучить аналогово-цифровое преобразование (АЦП) и цифро-аналоговое преобразование (ЦАП).
* Написать программу для управления яркостью светодиода с помощью потенциометра.

**Оборудование**

* Плата ESP32
* Потенциометр
* Светодиод
* Соединительные провода
* Плата макетная

## Теоретическая часть:

### Аналоговые входы

ESP32 имеет 12-битный АЦП (Analog-to-Digital Converter), который позволяет преобразовывать аналоговые сигналы (например, напряжение) в цифровые значения. Диапазон входных напряжений для аналоговых входов составляет от 0 В до 3,3 В (или от земли до питания платы).

### Аналоговые выходы

ESP32 имеет два 8-битных ЦАП (Digital-to-Analog Converter), которые позволяют преобразовывать цифровые значения в аналоговые сигналы (например, напряжение). Диапазон выходных напряжений для аналоговых выходов составляет от 0 В до 3,3 В.

### Подключение потенциометра

Один вывод потенциометра подключается к питанию (3,3 В), другой - к земле (GND), а третий - к аналоговому входу ESP32.

### Подключение светодиода

Один вывод светодиода подключается через резистор (например, 220 Ом) к аналоговому выходу ESP32, а другой - к земле (GND). Резистор ограничивает ток, проходящий через светодиод, и защищает его от повреждения.

### Программирование

Для управления яркостью светодиода с помощью потенциометра необходимо использовать функцию `analogRead()`, которая считывает значение с аналогового входа, и функцию `analogWrite()`, которая устанавливает значение на аналоговом выходе. Дополнительно можно использовать функцию `map()`, чтобы перевести значения из диапазона, считываемого с аналогового входа, в диапазон для управления яркостью светодиода.

### Аналогово-цифровое преобразование (АЦП)

АЦП преобразовывает аналоговый сигнал (непрерывный) в цифровой сигнал (дискретный). Процесс АЦП состоит из следующих этапов:

1. **Выборка:** Аналоговый сигнал дискретизируется, то есть его значение измеряется в определенные моменты времени.
2. **Квантование:** Измеренное значение аналогового сигнала округляется до ближайшего допустимого цифрового значения.
3. **Кодирование:** Округлённое значение преобразуется в двоичный код.

Разрешение АЦП ESP32 составляет 12 бит, что означает, что он может представлять аналоговый сигнал 4096 (2^12) дискретными цифровыми значениями.

### Цифро-аналоговое преобразование (ЦАП)

ЦАП преобразовывает цифровой сигнал (дискретный) в аналоговый сигнал (непрерывный). Процесс ЦАП состоит из следующих этапов:

1. **Декодирование:** Двоичный код преобразуется в соответствующее ему напряжение.
2. **Сглаживание:** Преобразованное напряжение сглаживается, чтобы уменьшить шум и сделать его более плавным.

Разрешение ЦАП ESP32 составляет 8 бит, что означает, что он может представлять цифровое значение 256 (2^8) дискретными уровнями напряжения.

## Задачи:

**1. Настройка среды разработки:**

Установите Arduino IDE или Espressif IDF (в зависимости от ваших предпочтений).
Подключите ESP32 к компьютеру с помощью USB-кабеля.
Выберите соответствующую плату ESP32 в Arduino IDE или Espressif IDF.

**2. Подключение компонентов:**

* **Потенциометр:**
    * Один вывод потенциометра подключите к питанию (3,3 В).
    * Другой вывод потенциометра подключите к земле (GND).
    * Третий вывод потенциометра подключите к выбранному аналоговому входу ESP32 (например, pin 34).
* **Светодиод:**
    * Один вывод светодиода подключите через резистор (например, 220 Ом) к выбранному аналоговому выходу ESP32 (например, pin 27).
    * Другой вывод светодиода подключите к земле (GND).

**3. Написание программы:**

**4. Тестирование программы:**

* Загрузите программу на ESP32.
* Светодиод должен плавно менять яркость при вращении потенциометра.

**5. Отчет:**

* Опишите **схему подключения** компонентов.
* **Предоставьте код** программы.
* **Опишите результат** тестирования.

**6. Дополнительные задачи:**

* Фильтрация аналоговых входов: Можно использовать программную фильтрацию (например, скользящее среднее) для сглаживания шумов на аналоговом входе.
* ШИМ (Широтно-импульсная модуляция): Используя ШИМ можно управлять яркостью светодиода более точно, чем с помощью аналогового выхода.

## Примеры кода для лабораторной работы:

```c++
const int potPin = 34; // Аналоговый вход (потенциометр)
const int ledPin = 27; // Аналоговый выход (светодиод)

void setup() {
  pinMode(potPin, INPUT);
  pinMode(ledPin, OUTPUT);
}

void loop() {
  int sensorValue = analogRead(potPin); // Считать значение с потенциометра
  int brightness = map(sensorValue, 0, 1023, 0, 255); // Преобразовать значение в диапазон 0-255
  analogWrite(ledPin, brightness); // Установить яркость светодиода
}
```

**Схема подключения:**

## Подключение потенциометра:

* **Вариант 1:**

```
+-------------------------------------------------+
|                                                 |
|    ESP32                                        |
|                                                 |
|    3.3V   <--> Потенциометр (один вывод)        |
|    A34    <--> Потенциометр (третий вывод)      |
|    GND   <--> Потенциометр (другой вывод)       |
|                                                 |
+-------------------------------------------------+
```

* **Вариант 2:**

```
+-------------------------------------------------+
|                                                 |
|    ESP32                                        |
|                                                 |
|    5V    <--> Потенциометр (один вывод)         |
|    A34    <--> Потенциометр (третий вывод)      |
|    GND   <--> Потенциометр (другой вывод)       |
|                                                 |
+-------------------------------------------------+
```

**Объяснение:**

* **Вариант 1:**
    * ESP32 работает от 3.3В.
    * Один вывод потенциометра подключается к **питанию (3,3 В)**.
    * Другой вывод потенциометра подключается к **земле (GND)**.
    * Третий вывод потенциометра подключается к **аналоговому входу A34 ESP32**.
* **Вариант 2:**
    * ESP32 может работать от 5В.
    * Один вывод потенциометра подключается к **питанию (5В)**.
    * Другой вывод потенциометра подключается к **земле (GND)**.
    * Третий вывод потенциометра подключается к **аналоговому входу A34 ESP32**.

## Подключение светодиода:

```
+-------------------------------------------------+
|                                                 |
|    ESP32                                        |
|                                                 |
|    A27    <--> Светодиод (анод)                 |
|    220 Ом <--> Светодиод (анод) <--> GND        |
|    GND   <--> Светодиод (катод)                 |
|                                                 |
+-------------------------------------------------+
```

**Объяснение:**

* Один вывод светодиода подключается к **аналоговому выходу A27 ESP32**.
* В цепь между анодом светодиода и аналоговым выходом ESP32 включен **резистор 220 Ом**.
* Катод светодиода подключается к **земле (GND)**.
* Резистор ограничивает ток, проходящий через светодиод, и защищает его от перегорания.
